---
title: scheduler
---
import { LinkButton, Steps } from '@astrojs/starlight/components';

The `scheduler` package provides periodic task execution using either fixed intervals or cron expressions.

Core Components:

- `Scheduler`: Executes a runner at configured intervals or cron schedules. Implements `Runner` interface so it can be used as an `application` service.
- `New(period, runner)`: Creates a new scheduler with the specified interval and runner.
- `NewWithCron(cronExpr, runner)`: Creates a new scheduler with a cron expression.

Supported cron formats:
- **Standard 5-field cron**: `"minute hour day month weekday"` (e.g., `"0 9 * * MON-FRI"`)
- **Custom descriptors**: `@yearly`, `@monthly`, `@weekly`, `@daily`, `@hourly`
- **Interval syntax**: `@every 30s`, `@every 5m`, `@every 2h`

[Full package docs at pkg.go.dev](https://pkg.go.dev/github.com/platforma-dev/platforma/scheduler)

## Step-by-step guide

<Steps>

1. Create a task function

    ```go
    func scheduledTask(ctx context.Context) error {
        log.InfoContext(ctx, "scheduled task executed")
        return nil
    }
    ```

    The function receives a context with a unique trace ID for each execution.

2. Create a scheduler

    ```go
    s := scheduler.New(time.Second, application.RunnerFunc(scheduledTask))
    ```

    First argument is the interval between executions. Second is any `application.Runner` implementation. Use `application.RunnerFunc` to wrap a function.

3. Run the scheduler

    ```go
    err := s.Run(ctx)
    ```

    The scheduler blocks and executes the task at each interval until the context is cancelled.

    Expected output:

    ```
    time=2025-01-01T12:00:01.000+00:00 level=INFO msg="scheduler task started" traceID=abc-123
    time=2025-01-01T12:00:01.000+00:00 level=INFO msg="scheduled task executed" traceID=abc-123
    time=2025-01-01T12:00:01.000+00:00 level=INFO msg="scheduler task finished" traceID=abc-123
    time=2025-01-01T12:00:02.000+00:00 level=INFO msg="scheduler task started" traceID=def-456
    time=2025-01-01T12:00:02.000+00:00 level=INFO msg="scheduled task executed" traceID=def-456
    time=2025-01-01T12:00:02.000+00:00 level=INFO msg="scheduler task finished" traceID=def-456
    ```

4. Handle errors

    ```go
    func scheduledTask(ctx context.Context) error {
        if err := doWork(); err != nil {
            return err // Logged automatically, scheduler continues
        }
        return nil
    }
    ```

    Errors returned from the task are logged but do not stop the scheduler. The next execution proceeds as normal.

</Steps>

## Using with Application

Since `Scheduler` implements the `Runner` interface, it can be registered as a service in an `Application`:

```go
app := application.New()

s := scheduler.New(time.Minute, application.RunnerFunc(scheduledTask))

app.RegisterService("scheduler", s)

app.Run(ctx)
```

The scheduler starts when the application runs and stops when the application shuts down.

## Cron Syntax Guide

The scheduler now supports cron expressions for more flexible scheduling patterns.

### Creating a Cron Scheduler

<Steps>

1. Create a cron scheduler

    ```go
    s, err := scheduler.NewWithCron("0 9 * * MON-FRI", application.RunnerFunc(scheduledTask))
    if err != nil {
        log.Fatal(err)
    }
    ```

    The first argument is a cron expression. Returns an error if the expression is invalid.

2. Run the scheduler

    ```go
    err := s.Run(ctx)
    ```

    Works the same as interval-based schedulers - blocks until context is cancelled.

</Steps>

### Common Cron Patterns

**Standard Cron Syntax** (`minute hour day month weekday`):

```go
// Every 5 minutes
scheduler.NewWithCron("*/5 * * * *", runner)

// Every hour at minute 0
scheduler.NewWithCron("0 * * * *", runner)

// Every 2 hours at minute 0
scheduler.NewWithCron("0 */2 * * *", runner)

// Every day at 9:30 AM
scheduler.NewWithCron("30 9 * * *", runner)

// Weekdays at 9 AM
scheduler.NewWithCron("0 9 * * MON-FRI", runner)

// First day of every month at midnight
scheduler.NewWithCron("0 0 1 * *", runner)
```

**Custom Descriptors**:

```go
// Every hour (at minute 0)
scheduler.NewWithCron("@hourly", runner)

// Every day at midnight
scheduler.NewWithCron("@daily", runner)

// Every Sunday at midnight
scheduler.NewWithCron("@weekly", runner)

// First day of month at midnight
scheduler.NewWithCron("@monthly", runner)

// January 1st at midnight
scheduler.NewWithCron("@yearly", runner)
```

**Interval Syntax**:

```go
// Every 30 seconds
scheduler.NewWithCron("@every 30s", runner)

// Every 5 minutes
scheduler.NewWithCron("@every 5m", runner)

// Every 2 hours
scheduler.NewWithCron("@every 2h", runner)

// Every 12 hours
scheduler.NewWithCron("@every 12h", runner)
```

### Interval vs Cron: When to Use Each

| Use Case | Recommendation | Example |
|----------|---------------|---------|
| Simple fixed interval | `New()` | Every 5 minutes |
| Specific time of day | `NewWithCron()` | Daily at 3 AM |
| Weekday-specific | `NewWithCron()` | Monday-Friday at 9 AM |
| Complex patterns | `NewWithCron()` | Every 15 min during business hours |
| Human-readable intervals | `NewWithCron()` with `@every` | `@every 30m` |

**Example: Interval vs Cron**

```go
// Interval-based: runs every 5 minutes starting immediately
interval := scheduler.New(5*time.Minute, runner)

// Cron-based: runs at :00, :05, :10, :15, etc. (aligned to clock)
cron, _ := scheduler.NewWithCron("*/5 * * * *", runner)

// Cron with @every: similar to interval but uses cron syntax
every, _ := scheduler.NewWithCron("@every 5m", runner)
```

## Complete examples

### Interval-based Scheduler

import { Code } from '@astrojs/starlight/components';
import importedCode from '../../../../../demo-app/cmd/scheduler/main.go?raw';

<Code code={importedCode} lang="go" title="scheduler.go" />

### Cron-based Scheduler

import importedCronCode from '../../../../../demo-app/cmd/scheduler-cron/main.go?raw';

<Code code={importedCronCode} lang="go" title="scheduler-cron.go" />
